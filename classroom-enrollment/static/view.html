<html>
  <head>
    <title>Sample Classroom Page</title>
    <link
      href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // console.log(googleUser);
      });

      function checkEnrollment(email) {
        const element = document.getElementById("statusbox");
        element.classList.remove("hidden");
        var data = new FormData();
        data.append(
          "json",
          JSON.stringify({
            email: email,
          })
        );

        let fetchJsonRequest = {
          cache: "no-cache",
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ email: email }),
        };

        fetch(`${window.origin}/enroll`, fetchJsonRequest)
          .then(function (response) {
            element.classList.remove("hidden");
            if (response.status != 200) {
              console.log(response.statusText);
            }
            response.json().then(function (data) {
              console.log("response ...", data);
              // window.location.href =
              //   "https://classroom.google.com/c/NTIwNzA5NDEyOTY5";
              window.location.href = "/studyhall";
            });
          })
          .catch(function (error) {
            console.log(error);
          });
      }
      function onSignIn(googleUser) {
        var profile = googleUser.getBasicProfile();
        console.log("ID: " + profile.getId()); // Do not send to your backend! Use an ID token instead.
        console.log("Name: " + profile.getName());
        console.log("Image URL: " + profile.getImageUrl());
        console.log("Email: " + profile.getEmail()); // This is null if the 'email' scope is not present.

        // window.location.href =
        //   "https://classroom.google.com/u/1/c/NTIwNzA5NDEyODcw";
        checkEnrollment(profile.getEmail());
      }
    </script>
    <script>
      function signOut() {
        var auth2 = gapi.auth2.getAuthInstance();
        auth2.signOut().then(function () {
          console.log("User signed out.");
        });
      }
    </script>
    <script src="https://www.google.com/recaptcha/api.js"></script>
    <script>
      function onSubmit(token) {
        document.getElementById("demo-form").submit();
      }
    </script>
    <meta
      name="google-signin-client_id"
      content="532482101496-tmijs31sk91ohop17lmaq9br96oi758m.apps.googleusercontent.com"
    />
  </head>

  <body>
    <div class="m-10 rounded border bg-gray-50 h-full/2 w-1/2 p-10 ml-40 mt-40">
      <div class="text-2xl text-gray-800">Sign in to enroll in class</div>
      <div class="text-base text-gray-400">
        Your email is used to enroll you in class!
      </div>
      <div
        id="statusbox"
        class="border mt-4 rounded text-red-400 hidden border-red-400 p-2"
      >
        <span class="inline-block mr-2 text-red-400 animate-spin">
          <svg
            class="text-red-400"
            fill="currentColor"
            width="24"
            height="24"
            viewBox="0 0 24 24"
          >
            <path
              d="M12.979 3.055c4.508.489 8.021 4.306 8.021 8.945.001 2.698-1.194 5.113-3.075 6.763l-1.633-1.245c1.645-1.282 2.709-3.276 2.708-5.518 0-3.527-2.624-6.445-6.021-6.923v2.923l-5.25-4 5.25-4v3.055zm-1.979 15.865c-3.387-.486-6-3.401-6.001-6.92 0-2.237 1.061-4.228 2.697-5.509l-1.631-1.245c-1.876 1.65-3.066 4.061-3.065 6.754-.001 4.632 3.502 8.444 8 8.942v3.058l5.25-4-5.25-4v2.92z"
            />
          </svg>
        </span>
        Checking enrollment status
      </div>
      <div
        class="g-signin2 pt-8 g-recaptcha"
        data-sitekey="6LclfzQgAAAAAKHKg58pbcVpmi44rWbBKBpznNra"
        data-callback="onSubmit"
        data-action="submit"
        data-onsuccess="onSignIn"
      ></div>
    </div>

    <!-- <a href="#" onclick="signOut();">Sign out</a> -->
  </body>
</html>
